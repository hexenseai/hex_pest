{% extends 'admin/base.html' %}
{% load i18n %}

{% block title %}{% if subtitle %}{{ subtitle }} | {% endif %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block branding %}
    {% include "unfold/helpers/site_branding.html" %}
{% endblock %}

{% block content %}
    {# Dashboard üst blok: özet kartlar + son listeler #}
    {% if dashboard_stats or dashboard_recent_work_records or dashboard_open_talepler %}
    <div class="mb-8">
        {% if dashboard_stats %}
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
            <a href="{% url 'admin:core_customer_changelist' %}" class="rounded-xl border border-base-200 dark:border-base-700 bg-white dark:bg-base-800 p-4 shadow-sm hover:shadow-md transition-shadow">
                <div class="text-2xl font-bold text-primary-600 dark:text-primary-400">{{ dashboard_stats.musteri_count|default:0 }}</div>
                <div class="text-sm text-base-font-muted-light dark:text-base-font-muted-dark">Müşteri</div>
            </a>
            <a href="{% url 'admin:core_facility_changelist' %}" class="rounded-xl border border-base-200 dark:border-base-700 bg-white dark:bg-base-800 p-4 shadow-sm hover:shadow-md transition-shadow">
                <div class="text-2xl font-bold text-primary-600 dark:text-primary-400">{{ dashboard_stats.tesis_count|default:0 }}</div>
                <div class="text-sm text-base-font-muted-light dark:text-base-font-muted-dark">Tesis</div>
            </a>
            <a href="{% url 'admin:core_talep_changelist' %}" class="rounded-xl border border-base-200 dark:border-base-700 bg-white dark:bg-base-800 p-4 shadow-sm hover:shadow-md transition-shadow">
                <div class="text-2xl font-bold text-amber-600 dark:text-amber-400">{{ dashboard_stats.talep_bekleyen|default:0 }}</div>
                <div class="text-sm text-base-font-muted-light dark:text-base-font-muted-dark">Bekleyen talep</div>
            </a>
            <a href="{% url 'admin:core_workrecord_changelist' %}" class="rounded-xl border border-base-200 dark:border-base-700 bg-white dark:bg-base-800 p-4 shadow-sm hover:shadow-md transition-shadow">
                <div class="text-2xl font-bold text-primary-600 dark:text-primary-400">{{ dashboard_stats.is_kaydi_ay|default:0 }}</div>
                <div class="text-sm text-base-font-muted-light dark:text-base-font-muted-dark">Bu ay iş kaydı</div>
            </a>
        </div>
        {% endif %}

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            {% if dashboard_recent_work_records %}
            <div class="rounded-xl border border-base-200 dark:border-base-700 bg-base-50 dark:bg-base-800 overflow-hidden">
                <div class="px-4 py-3 border-b border-base-200 dark:border-base-700 flex justify-between items-center">
                    <h2 class="font-semibold text-base-900 dark:text-base-100">Son iş kayıtları</h2>
                    <a href="{% url 'admin:core_workrecord_changelist' %}" class="text-sm text-primary-600 dark:text-primary-400 hover:underline">Tümü</a>
                </div>
                <ul class="divide-y divide-base-200 dark:divide-base-700">
                    {% for row in dashboard_recent_work_records %}
                    <li class="px-4 py-3 hover:bg-base-100 dark:hover:bg-base-700/50">
                        {% if row.url %}
                        <a href="{{ row.url }}" class="block">
                            <span class="font-medium text-base-900 dark:text-base-100">{{ row.form_numarasi }}</span>
                            <span class="text-sm text-base-font-muted-light dark:text-base-font-muted-dark"> — {{ row.tarih|date:"d.m.Y" }} · {{ row.personel }}{% if row.ekip %} ({{ row.ekip }}){% endif %}</span>
                        </a>
                        {% else %}
                        <span class="font-medium">{{ row.form_numarasi }}</span>
                        <span class="text-sm text-base-font-muted-light dark:text-base-font-muted-dark"> — {{ row.tarih|date:"d.m.Y" }} · {{ row.personel }}</span>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
                {% if not dashboard_recent_work_records %}
                <p class="px-4 py-4 text-sm text-base-font-muted-light dark:text-base-font-muted-dark">Kayıt yok.</p>
                {% endif %}
            </div>
            {% endif %}

            {% if dashboard_open_talepler %}
            <div class="rounded-xl border border-base-200 dark:border-base-700 bg-base-50 dark:bg-base-800 overflow-hidden">
                <div class="px-4 py-3 border-b border-base-200 dark:border-base-700 flex justify-between items-center">
                    <h2 class="font-semibold text-base-900 dark:text-base-100">Bekleyen / planlanan talepler</h2>
                    <a href="{% url 'admin:core_talep_changelist' %}" class="text-sm text-primary-600 dark:text-primary-400 hover:underline">Tümü</a>
                </div>
                <ul class="divide-y divide-base-200 dark:divide-base-700">
                    {% for row in dashboard_open_talepler %}
                    <li class="px-4 py-3 hover:bg-base-100 dark:hover:bg-base-700/50">
                        {% if row.url %}
                        <a href="{{ row.url }}" class="block">
                            <span class="font-medium text-base-900 dark:text-base-100">{{ row.customer }}</span>
                            <span class="text-sm text-base-font-muted-light dark:text-base-font-muted-dark"> — {{ row.tarih|date:"d.m.Y" }} · {{ row.durum }} · {{ row.tip }}</span>
                        </a>
                        {% else %}
                        <span class="font-medium">{{ row.customer }}</span>
                        <span class="text-sm text-base-font-muted-light dark:text-base-font-muted-dark"> — {{ row.tarih|date:"d.m.Y" }} · {{ row.durum }}</span>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
                {% if not dashboard_open_talepler %}
                <p class="px-4 py-4 text-sm text-base-font-muted-light dark:text-base-font-muted-dark">Bekleyen talep yok.</p>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {# Mevcut yapı: uygulama listesi + son eylemler #}
    <div class="flex flex-col lg:flex-row lg:gap-8">
        <div class="grow">
            {% include "unfold/helpers/app_list_default.html" %}
        </div>
        {% include "unfold/helpers/history.html" %}
    </div>
{% endblock %}
